Незаконченный проект.
Выгрузка данных из OSM послойно в NGW (data.nextgis.com)

Написать сразу универсальный скрипт с автоматическим обновлением оказалось проще, чем выгружать данные вручную.

Описание
=======================

Регулярная выгрузка и обновление из OSM разных фич в отдельные слои в NGW.  
Требуется: gdal 2, osmctools

Использование
=======================

* git clone
* В /tree/config.py задать параметры доступа к базе
* python update_dump.py - дамп сам скачается, и обновится
* python tree/main.py - при первом запуске грохнется
* Сгенерируется файл tree/[...].geojson. Его нужно вручную закачать в NGW - это будет новый слой
* В файле tree/main.py в строке с вызовом update_dump_from_geojson задать id слоя, полученного из предыдущего шага.
* теперь каждый раз: 
* python update_dump.py 
* python tree/main.py

Алгоритм
========================

* При первом запуске скрипта выкачивается планета. По крону (допустим раз в неделю) запускаются отдельные скрипты, по одному на каждый слой. 
* Скрипт через osmupdate обновляет свой отфильтрованный локальный дамп, 
* затем фильтрует его по тегам ещё раз, и оставляет на диске до следующей недели. 
* Отфильтрованный дамп импортируется в PostGIS с заменой всех таблиц.
* Данные фильтруются, на этом шаге возможна постобработка.
* Слой выгружается в geojson, и с ним синхронизируется слой в ngw (потом можно будет заменить на более технологичный скрипт синхронизации, чтоб брал сразу из PostGIS, но у меня был готовый скрипт)

* После завершения работы всех скриптов очищается папка с файлами osc.

Такой алгоритм был выбран что бы:

1. Избежать двухдневного начального импортирования базы
2. Избежать необходимости двухдневного импортирования всей базы при добавлении новых тегов.

Выгрузка каждого слоя выполняется отдельным скриптом, таким образом легко добавлять новые слои и теги. 
osmupdate запускается для каждого скрипта по очереди, но они вроде бы используют общую папку с загруженными osс-файлами. 


Структура
============================

Каждая выгрузка кладётся в отдельную папку



В папках для каждой выгрузки лежат

* конфиг с id слоя
* стиль osm2pgsql
* скрипт, который запускает импорт, фильтрацию и синхронизацию

В корне лежат

* update_ngw_from_geojson.py

Деревья в РБ
-----------------------------------

Для отладки. Выгрузка natural=tree в РБ.

Выгрузка столиц (не действует)
-----------------------------------

В слое должны быть столицы административных образований.
Затем к этому слою будут делаться стили - показывать только столицы стран, или же все столицы административных образований кружками, а столицы стран - звёздочкаи.

Нужные теги:
::::::::::::::::::::::::::::::::::::

capital
    Если capital=yes, то это столица страны
    Если capital-цифра, то это столица административного образования
admin_level
    Уровень административного подчинения населённого пункта
name
name:ru
